1️⃣ 전체 기능 매핑 표
#	기존 백엔드/프론트 엔드 기능	Telegram In‑App UI·API 구현 포인트	비고
01	CRM 통계(KPI) API (/admin/crm/stats)	KPI 그리드 + 세그먼트 차트 (FR‑02, FR‑03)	30 초 폴링
02	사용자 리스트·검색 (/admin/users)	사용자 검색/조회 모달 (버튼 → Telegram.WebApp.openLink('/admin/users') 혹은 인앱 리스트)	대규모 리스트는 페이징
03	사용자 일괄 Import (UserImportModal.tsx)	Import 버튼 → 파일 업로드 UI (HTML <input type="file">) → POST /admin/users/import	파일 형식 CSV, JSON
04	사용자 관리 (
UserAdminPage.tsx
)	프로필 카드 → “프로필 보기·수정·삭제” 액션 (Telegram WebApp openLink 혹은 인앱 모달)	권한 체크 (admin)
05	게임 토큰 지급·차감 (
GameTokenGrantPage.tsx
)	토큰 지급 폼 (숫자 입력 + 대상 선택) → POST /admin/game-tokens/grant	실시간 토스트 알림
06	게임 토큰 로그 (
GameTokenLogsPage.tsx
)	로그 테이블 (스크롤 무한 로드) → GET /admin/game-tokens/logs	날짜·유형 필터
07	Vault(금고) 관리 (
VaultAdminPage.tsx
)	Vault 배너 + 해제/충전 버튼 → POST /admin/vault/unlock / POST /admin/vault/deposit	조건부 표시 (eligible)
08	팀 배틀 (TeamBattle API·페이지)	팀 배틀 현황 카드 → GET /team-battle/status	팀 선택·참가 버튼
09	랭킹·세그먼트 규칙 (
SegmentRulesPage.tsx
)	세그먼트 규칙 리스트 → GET /admin/segments	규칙 편집 모달
10	설문·서베이 (
SurveyAdminPage.tsx
, 
SurveyRunnerPage.tsx
)	설문 리스트 + 응답 보기 → GET /admin/surveys	설문 시작·종료 토글
11	외부 랭킹 입력 (external_ranking_* 테이블)	외부 랭킹 입력 폼 → POST /admin/external-ranking	관리자 전용
12	알림·메시지 센터 (
MessageCenterPage.tsx
)	메시지 전송 버튼 → Telegram.WebApp.openLink('/admin/messages')	채팅형 UI는 Telegram 자체 채팅 사용
13	시즌 패스·보상 (
SeasonPassPage.tsx
, 
SeasonPassFigmaPage.tsx
)	시즌 패스 현황 카드 → GET /season-pass/status	보상 클레임 버튼
14	다중 게임(룰렛·주사위·복권) 상태 (/admin/games/*)	게임 상태 아이콘 (Crown, Zap, etc.) → GET /admin/games/status	KPI 카드에 포함
15	관리자 메시지 (
admin_message.py
)	관리자 알림 배너 → GET /admin/messages/latest	실시간 푸시 (Telegram WebApp showAlert)
16	시스템 설정·배포 (
.env
, docker‑compose)	앱 초기화 → Telegram.WebApp.initDataUnsafe 로 사용자·언어 정보 획득	배포 시 HTTPS 필수
핵심: 위 16가지 기능이 Telegram In‑App에서도 동일하게 동작하도록 UI·API·SDK 연동을 설계합니다.

2️⃣ UI 구조 – 전체 페이지 레이아웃
<main class="tg-app">
  ├─ <header class="tg-header">                     // 헤더 (앱명·다크 토글)
  ├─ <section class="kpi-section">                // KPI 그리드 (8개 카드)
  ├─ <section class="segment-chart-section">      // 세그먼트 차트 (SVG)
  ├─ <section class="action-panel">               // 액션 카드 3개
  ├─ <section class="team-battle-section">        // 팀 배틀 현황
  ├─ <section class="ranking-section">            // TOP 3 팀·외부 랭킹
  ├─ <section class="vault-banner">               // 금고 배너 (조건부)
  ├─ <section class="admin-tools">                // 관리자 전용 툴 (Import, Token, Survey, etc.)
  └─ <footer class="tg-footer">                    // Telegram WebApp 버전 표시·링크
</main>
반응형: 모바일(≤ 640 px) → 1‑컬럼, 태블릿(≥ 768 px) → 2‑컬럼, 데스크톱(≥ 1440 px) → 4‑컬럼 KPI·액션.
다크‑모드: CSS 변수 --color-bg, --color-surface 로 전역 제어, 토글 시 document.documentElement.dataset.theme = 'dark' | 'light'.
3️⃣ API 연동 상세
API	메서드	요청·응답 예시	사용 UI
/admin/crm/stats	GET	{ total_users, active_users, conversion_rate, whale_count, empty_tank_count, ltv, arpu, churn_rate, new_user_growth, segments:{DAILY,…} }	KPI·세그먼트 차트
/admin/users	GET (쿼리: search, page)	[{id, nickname, level, token_balance}]	사용자 리스트·검색
/admin/users/import	POST (multipart)	{ success:true, imported:123 }	Import 모달
/admin/game-tokens/grant	POST	{ user_id, token_type, amount }	토큰 지급 폼
/admin/game-tokens/logs	GET (쿼리: page, type)	[{id, user, type, amount, created_at}]	로그 테이블
/admin/vault/unlock	POST	{ unlocked:true, amount }	Vault 배너·버튼
/team-battle/status	GET	{ season_name, my_team:{name, points, members}, top_teams:[...] }	팀 배틀 섹션
/admin/segments	GET	[{id, name, rule}]	세그먼트 규칙 리스트
/admin/surveys	GET/POST	[{id, title, status, start, end}]	설문 관리
/admin/external-ranking	POST	{ user_id, rank, deposit }	외부 랭킹 입력
/admin/messages/latest	GET	{ title, body, url }	관리자 알림 배너
/season-pass/status	GET	{ active, rewards:[...] }	시즌 패스 카드
/admin/games/status	GET	{ roulette:{token_type, token_balance}, dice:{…}, lottery:{…} }	KPI 아이콘·값
/admin/messages	GET	[{id, title, content}]	메시지 센터 (Telegram WebApp openLink)
인증: 모든 요청에 Authorization: Bearer <tg.initDataUnsafe.user.id> 헤더 삽입.

에러 처리: fetch 실패 시 showToast('⚠️ API 오류', 'error') + 재시도 버튼 표시.

4️⃣ 핵심 UI 컴포넌트 상세 (HTML + CSS + JS)
4.1 KPI Card (예시)
html
<div class="kpi-card" data-test-id="kpi-total-users">
  <div class="kpi-icon"><svg><!-- Users icon --></svg></div>
  <div class="kpi-title">전체 잠재고객</div>
  <div class="kpi-value" id="kpi-total-users">-</div>
  <div class="kpi-sub">123,456명 활성</div>
</div>
css
.kpi-card {
  background: var(--color-surface);
  border: 1px solid var(--color-muted);
  border-radius: var(--radius-md);
  padding: var(--gap-md);
  position: relative;
  overflow: hidden;
  transition: transform .2s, box-shadow .2s;
}
.kpi-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,.3); }
.kpi-card::after {
  content: "";
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at top right, var(--kpi-color, #91F402)10%, transparent);
  opacity: .15;
}
js
function renderKPI(data) {
  const map = {
    total_users: {title:'전체 잠재고객', icon:'users', sub:`${data.active_users}명 활성`, color:'#91F402'},
    conversion_rate: {title:'전환율 (결제)', icon:'trending-up', sub:`${data.paying_users}명 결제`, color:'#91F402'},
    whale_count: {title:'고액 사용자 (Whale)', icon:'crown', sub:'VIP 타겟', color:'purple'},
    empty_tank_count: {title:'빈 탱크 (기회)', icon:'droplets', sub:'잔액 부족', color:'red'},
    ltv: {title:'LTV (평균가치)', icon:'dollar-sign', sub:'User당 평균 가치', color:'yellow'},
    arpu: {title:'ARPU (평균보유)', icon:'bar-chart-2', sub:'User당 평균 잔액', color:'cyan'},
    churn_rate: {title:'이탈률 (Churn)', icon:'user-minus', sub:'30일 미접속', color:'orange'},
    new_user_growth: {title:'신규 성장률', icon:'activity', sub:'최근 7일 가입', color:'green'}
  };
  Object.entries(map).forEach(([key, cfg]) => {
    const el = document.getElementById(`kpi-${key}`);
    if (el) {
      el.textContent = data[key] != null ? `${data[key].toLocaleString()}` : '-';
      el.closest('.kpi-card').querySelector('.kpi-title').textContent = cfg.title;
      el.closest('.kpi-card').querySelector('.kpi-sub').textContent = cfg.sub;
      el.closest('.kpi-card').style.setProperty('--kpi-color', cfg.color);
    }
  });
}
4.2 세그먼트 차트 (SVG)
html
<svg class="segment-chart" viewBox="0 0 200 150" aria-label="세그먼트 차트"></svg>
js
function drawSegmentChart(segments) {
  const svg = document.querySelector('.segment-chart');
  const max = Math.max(...Object.values(segments));
  const width = 40;
  const gap = 20;
  let x = 0;
  svg.innerHTML = '';
  Object.entries(segments).forEach(([name, value], i) => {
    const height = (value / max) * 120;
    const bar = document.createElementNS('http://www.w3.org/2000/svg','rect');
    bar.setAttribute('x', x);
    bar.setAttribute('y', 130 - height);
    bar.setAttribute('width', width);
    bar.setAttribute('height', height);
    bar.setAttribute('fill', segmentColors[name] || '#777');
    bar.setAttribute('data-test-id', `segment-${name.toLowerCase()}`);
    svg.appendChild(bar);
    const label = document.createElementNS('http://www.w3.org/2000/svg','text');
    label.setAttribute('x', x + width/2);
    label.setAttribute('y', 145);
    label.setAttribute('text-anchor','middle');
    label.textContent = name;
    svg.appendChild(label);
    x += width + gap;
  });
}
4.3 액션 카드 (예시)
html
<div class="action-card" data-test-id="action-vip" onclick="openAction('https://t.me/yourbot?start=vip')">
  <div class="action-icon"><svg><!-- Crown icon --></svg></div>
  <div class="action-label">VIP 감사 선물</div>
</div>
js
function openAction(url){
  if (window.Telegram && Telegram.WebApp) {
    Telegram.WebApp.openLink(url);
  } else {
    window.open(url, '_blank');
  }
}
4.4 Vault 배너 (조건부)
html
<section class="vault-banner" id="vaultBanner" data-visible="false">
  <div class="vault-info">
    <p class="vault-title">잠긴 금고 <span id="vaultAmount">-</span>원</p>
    <button class="vault-toggle" onclick="toggleVaultInfo()">자세히 보기</button>
  </div>
  <div class="vault-detail" hidden>
    <p>외부 충전 확인 시 금고 금액이 일부 해금됩니다.</p>
    <button onclick="unlockVault()">해금 요청</button>
  </div>
</section>
js
async function loadVault(){
  const data = await fetch('/admin/vault/status').then(r=>r.json());
  const banner = document.getElementById('vaultBanner');
  if (data.eligible && data.vaultBalance > 0){
    banner.dataset.visible = 'true';
    banner.querySelector('#vaultAmount').textContent = data.vaultBalance.toLocaleString();
  }
}
async function unlockVault(){
  try{
    const res = await fetch('/admin/vault/unlock', {method:'POST'});
    const json = await res.json();
    showToast('✅ 금고 해금 완료', 'success');
    loadVault();
  }catch(e){ showToast('⚠️ 해금 실패', 'error'); }
}
5️⃣ 관리자 전용 도구 섹션
도구	UI 요소	API 연동	비고
사용자 일괄 Import	파일 업로드 버튼 + 진행 바	POST /admin/users/import	CSV/JSON, 최대 10 MB
게임 토큰 지급	토큰 종류·수량 입력 폼	POST /admin/game-tokens/grant	즉시 토스트
설문 관리	설문 리스트·추가·편집 모달	GET/POST /admin/surveys	시작·종료 날짜 UI
세그먼트 규칙 편집	규칙 테이블·편집 모달	GET/PUT /admin/segments/:id	실시간 반영
외부 랭킹 입력	랭킹·입금 입력 폼	POST /admin/external-ranking	관리자 전용
관리자 알림	배너·팝업	GET /admin/messages/latest	Telegram.WebApp.showAlert 사용
접근 제어: window.Telegram.WebApp.initDataUnsafe?.user?.is_admin 로 UI 표시 여부 결정.

6️⃣ 접근성·보안 체크리스트
항목	기준
색 대비	텍스트 vs 배경 ≥ 4.5:1 (WCAG AA)
ARIA	모든 버튼·링크에 aria-label 제공
키보드	Tab 순서 보장, :focus-visible 스타일
HTTPS	모든 API 호출은 https://
CSRF	X-CSRF-Token 헤더 (FastAPI csrf_protect 미들웨어)
입력 검증	파일·숫자·텍스트 모두 서버‑사이드 검증
Telegram 인증	initData 검증 (Telegram.WebApp.checkInitData)
7️⃣ 배포·운영 가이드 (요약)
빌드
bash
npm run build   # Vite → dist/
정적 서버 (Nginx)
nginx
location /telegram/ {
    try_files $uri $uri/ =404;
}
Telegram Bot 설정
BotFather → Set Inline Keyboard → Web App URL에 https://your.domain.com/telegram/index.html 입력.
setWebAppUrl API 로 URL 업데이트 시 https 필수.
CI/CD (GitHub Actions 예시)
yaml
- name: Build
  run: npm ci && npm run build
- name: Deploy
  run: rsync -avz dist/ user@server:/var/www/telegram
모니터링
Nginx access log + FastAPI log → API 응답 시간 < 200 ms 목표.
Telegram WebApp showAlert 로 긴급 공지 전송.
